<!DOCTYPE html>
<!-- Bootstrap from https://getbootstrap.com/docs/4.0/getting-started/introduction/ -->
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  <title>Paul's Lists</title>
</head>

<body>
  <div class="container">
    <div class="row">
      <section class="col-12">
        <nav class="navbar navbar-expand-sm bg-primary navbar-dark mb-2">
          <div class="container">
            <div class="navbar-brand">Paul's Lists</div>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsableNav" aria-controls="collapsableNav" aria-expanded="false">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="collapsableNav">
              <div class="navbar-nav ml-auto">
                <a href="#" class="nav-item nav-link active">Home</a>
                <div class="dropdown">
                  <a href="#" class="nav-item nav-link dropdown-toggle" data-toggle="dropdown" id="listsDropdown" aria-haspopup="true" aria-expanded="false" href="#">Lists</a>
                  <div class="dropdown-menu" aria-labelledby="listsDropdown">
                    <a class="dropdown-item" href="#">New...</a>
                  </div>
                </div>
                <a href="#" class="nav-item nav-link">About</a>
              </div>
              <!--navbar-nav -->
            </div><!-- navbar-collapse -->
          </div>
        </nav>
        <h2 id="listName" class="d-none"></h2>
        <div id="listItems" role="tablist" aria-multiselectable="true">
        </div>
      </section>
    </div>
  </div>

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  <script>
    $(document).ready(function() {

      var valueAfterDelay = function(value, interested) {
        setTimeout(function() {
          interested(value);
        }, 100);
      };

      var exampleList = [{
          name: "trekking poles",
          notes: "Should be collapsible into 3 or 4 sections to make stowage inside your rucksack easier. Expect to pay approx £80",
          urls: ["https://www.cotswoldoutdoor.com/c/equipment/walking-trekking-poles.html"]
        },
        {
          name: "crampon bag",
          notes: "Expect to pay approx £14",
          urls: []
        },
        {
          name: "snow/ski goggles",
          notes: "Look for OTG goggles. Dual pane (2 layer lenses) is recommended. Perhaps 30% VLT",
          urls: ["https://skitripguide.com/best-otg-goggles-for-skiing/", "https://www.glisshop.co.uk/accessories/goggles/otg/"]
        },
        {
          name: "waterproof gloves",
          notes: "At least two pairs are essential. They should be dexterous enough that you can put crampons on whilst wearing them. The Mountain Equipment Guide or similar is recommended. The Mountain Equipment gloves are £80 for one pair.",
          urls: ["https://www.wwarn.org"]
        },
        {
          name: "mid-layers",
          notes: "A couple of mid weight layers, ideally fleece, gives more flexibility for managing your temperature rather than one thick one.",
          urls: []
        },
      ];

      var listItems = document.querySelector("#listItems");
      var listName = document.querySelector("#listName");

      var createChildOf = function(parent, elementType, classNames, attributes) {
        var newElement = document.createElement(elementType);
        if (classNames) {
          classNames.forEach(function(name) {
            newElement.classList.add(name);
          });
        }
        if (attributes) {
          for (var p in attributes) {
            newElement.setAttribute(p, attributes[p]);
          }
        }
        parent.appendChild(newElement);
        return newElement;
      }

      var appendTextNodeTo = function(parent, text) {
        parent.appendChild(document.createTextNode(text));
      };

      var addListItem = function(listItem) {
        var isFirstItem = listItems.children.length == 0;
        var itemId = encodeURIComponent(listItem.name);
        var card = createChildOf(listItems, "div", ["card", "border-info", "mb-2"]);
        var cardHeader = createChildOf(card, "div", ["card-header"], {
          "role": "tab",
          "id": "heading-for-" + itemId
        });
        var heading = createChildOf(cardHeader, "h5", ["mb-0"]);
        var anchor = createChildOf(heading, "a", undefined, {
          "data-toggle": "collapse",
          "aria-controls": itemId,
          "href": "#" + itemId
        });
        appendTextNodeTo(anchor, listItem.name);
        var cardBlockContainer = createChildOf(card, "div", isFirstItem ? ["collapse", "show"] : ["collapse"], {
          "role": "tabpanel",
          "data-parent": "#listItems",
          "aria-labelledby": "heading-for-" + itemId,
          "id": itemId
        });
        var cardBlock = createChildOf(cardBlockContainer, "div", ["card-block"]);
        var cardBody = createChildOf(cardBlock, "div", ["card-body"]);
        var cardText = createChildOf(cardBody, "p", ["card-text"]);
        appendTextNodeTo(cardText, listItem.notes);
        listItem.urls.forEach( function(url) {
          var anchor = createChildOf(cardBody, "a", ["card-link", "d-block", "ml-0"], { "href": url });
          appendTextNodeTo(anchor, url);
        });
      };

      var removeChildren = function(parent) {
        while (parent.firstChild) {
          parent.removeChild(parent.firstChild);
        }
      }

      var layoutList = function(name, list) {
        removeChildren(listItems);
        removeChildren(listName);
        appendTextNodeTo(listName, name);
        listName.classList.remove("d-none");
        list.forEach(function(listItem) {
          addListItem(listItem);
        });
      };

      var showError = function(error) {
        alert(error);
      };

      var fetchList = function(listName) {
        return new Promise(function(succeed, fail) {
          valueAfterDelay([listName, exampleList], succeed);
        });
      };

      var addListOption = function(listName) {
        var dropdownMenuOfLists = document.querySelector(".dropdown-menu");
        var option = document.createElement("a");
        option.textContent = listName;
        option.classList.add("dropdown-item");
        dropdownMenuOfLists.appendChild(option);
      };

      var fetchListNames = function() {
        return new Promise(function(succeed, fail) {
          valueAfterDelay(["a", "b", "c"], succeed);
        });
      };

      fetchListNames().then(function(names) {
          names.forEach(function(name) {
            addListOption(name);
          });
        },
        function(error) {
          alert(error);
        });

      fetchList("Plas y Brenin Essentials").then(
        function(list) {
          layoutList(list[0], list[1]);
        },
        function(error) {
          showError(error);
        });

    });
  </script>
</body>

</html>
