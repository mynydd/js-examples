<!DOCTYPE html>
<!-- Bootstrap from https://getbootstrap.com/docs/4.0/getting-started/introduction/ -->
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <title>Paul's Lists</title>
  </head>
<body>
  <nav class="navbar navbar-expand-sm bg-primary navbar-dark">
    <div class="container">
      <div class="navbar-brand">Paul's Lists</div>
      <button class="navbar-toggler" type="button"
      data-toggle="collapse" data-target="#collapsableNav"
      aria-controls="collapsableNav"
      aria-expanded="false"><span class="navbar-toggler-icon"></span></button>
      <div class="collapse navbar-collapse" id="collapsableNav">
        <div class="navbar-nav">
          <a href="#" class="nav-item nav-link active">Home</a>
          <div class="dropdown">
            <a href="#" class="nav-item nav-link dropdown-toggle"
            data-toggle="dropdown" id="listsDropdown"
            aria-haspopup="true" aria-expanded="false"
            href="#">Lists</a>
            <div class="dropdown-menu" aria-labelledby="listsDropdown">
              <a class="dropdown-item" href="#">Create</a>
              <a class="dropdown-item" href="#">View</a>
            </div>
          </div>
          <a href="#" class="nav-item nav-link">About</a>
        </div><!--navbar-nav -->
      </div><!-- navbar-collapse -->
    </div>
  </nav>

<label for="listNames">Lists</label>
<select id="listNames"></select>
<div id="listItems" class="container">
</div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<script>
(function() {

  var valueAfterDelay = function(value, interested) {
    setTimeout(function() { interested(value); }, 100);
  };

  var exampleList = [
    {id: 1, checked: false, name: "some name", notes: "some notes", urls: ["https://www.iddo.org"]},
    {id: 2, checked: true, name: "some other name", notes: "some other notes", urls: ["https://www.wwarn.org"]},
    {id: 3, checked: true, name: "some other name and more", notes: "some other notes", urls: ["https://www.wwarn.org"]},
    {id: 4, checked: true, name: "some other name", notes: "some other notes and more and more and more", urls: ["https://www.wwarn.org"]},
    {id: 5, checked: true, name: "some other name", notes: "some other notes", urls: ["https://www.wwarn.org"]},
  ];

  var listNames = document.querySelector("#listNames");
  var listItems = document.querySelector("#listItems");

  var createLabel = function(associatedControlId, text) {
    var label = document.createElement("label");
    label.classList.add("px-2");
    label.setAttribute("for", associatedControlId);
    label.appendChild(document.createTextNode(text));
    return label;
  };

  var addDivTo = function(parent, classNames) {
    var div = document.createElement("div");
    div.classList.add(classNames);
    parent.appendChild(div);
    return div;
  }

  var createLabelledControl = function(controlId, controlDomElementName, controlLabel, domElementInitialiser) {
    var div = document.createElement("div");
    div.classList.add("col-12", "col-md-4", "text-dark", "border");
    var innerRow = addDivTo(div, ["row"]);
    var labelCol = addDivTo(innerRow, ["col", "col"]);
    var controlCol = addDivTo(innerRow, ["col", "col"]);
    var label = createLabel(controlId, controlLabel);
    labelCol.appendChild(label);
    label.classList.add("form-control-label");
    var control = document.createElement(controlDomElementName);
    control.id = controlId;
    domElementInitialiser(control);
    controlCol.appendChild(control);
    return div;
  };

  var createControlForUrls = function(listItem) {
    var div = document.createElement("div");
    var ul = document.createElement("ul");
    listItem.urls.forEach( function(url) {
      var li = document.createElement("li");
      li.appendChild(document.createTextNode(url));
      ul.appendChild(li);
    });
    div.appendChild(ul);
    return div;
  };

  var addListItem = function(listItem) {
    var listItemDiv = document.createElement("div");
    listItemDiv.classList.add("row", "align-items-start", "bg-light");
    listItemDiv.appendChild(
      createLabelledControl(
        listItem.id + "-checkbox",
        "input",
        "checked",
        function(ctl) {
          ctl.type = "checkbox";
          ctl.checked = listItem.checked;
        }));
    listItemDiv.appendChild(
      createLabelledControl(
        listItem.id + "-name",
        "input",
        "name",
        function(ctl) {
          ctl.type = "text";
          ctl.value = listItem.name;
          ctl.classList.add("form-control");
        }));
    listItemDiv.appendChild(
      createLabelledControl(
        listItem.id + "-notes",
        "textarea",
        "notes",
        function(ctl) {
          ctl.value = listItem.notes;
          ctl.classList.add("form-control");
        }));
    listItemDiv.appendChild(createControlForUrls(listItem));
    listItems.appendChild(listItemDiv);
  };

  var layoutList = function(list) {
    while (listItems.firstChild) {
      listItems.removeChild(listItems.firstChild);
    }
    list.forEach( function(listItem) { addListItem(listItem); });
  };

  var showError = function(error) { alert(error); };

  var fetchList = function(listName) {
    return new Promise(function(succeed, fail) {
      valueAfterDelay(exampleList, succeed);
    });
  };

  listNames.addEventListener("change", function(event) {
    fetchList(event.target.value).then(
      function(list) { layoutList(list); },
      function(error) { showError(error); });
  });

  var addListOption = function(listName) {
    var option = document.createElement("option");
    option.textContent = listName;
    listNames.appendChild(option);
  };

  var fetchListOptions = function(){
    return new Promise(function(succeed, fail) {
      valueAfterDelay(["a","b","c"], succeed);
    });
  };

  fetchListOptions().then(function(names) {
    names.forEach( function(name) {
      addListOption(name);
    });
  },
  function(error) {
    alert(error);
  });

  fetchList("list name").then(
    function(list) { layoutList(list); },
    function(error) { showError(error); });

}());
</script>
</body>
</html>
